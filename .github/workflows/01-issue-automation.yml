name: Issue automation

on:
  issues:
    types:
      - labeled
  workflow_dispatch:
    inputs:
      title:
        type: string
        required: true
        description: Issue title
      label:
        type: choice
        options:
          - auto-created
          - bug
        description: (optional) Issue label
        default: auto-created
        required: false

jobs:
  create-issue:
    if: github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Create issue (without label)
        if: ${{ !inputs.label }}
        run: gh issue create --repo ${{ github.repository }} --title "${{ env.title }}" --body "Created using the CLI in a workflow"
        env:
          title: ${{ inputs.title }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create issue (with label)
        if: ${{ inputs.label }}
        run: gh issue create --repo ${{ github.repository }} --title "${{ env.title }}" --label ${{ inputs.label }} --body "Created using the CLI in a workflow"
        env:
          title: ${{ inputs.title }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
  add-comment:
    if: github.event.label.name == 'add-comment'
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
    - name: Add comment
      run: gh issue comment $ISSUE --body "Oh look at you, adding labels! Very fancy... üòí"
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        ISSUE: ${{ github.event.issue.html_url }}

    - name: Add label
      run: |
        gh issue edit $ISSUE --add-label "i-can-do-that-too"
        gh issue comment $ISSUE --body "Would you look at that! üò± I too can add labels. Not so special now, are you? üòè"
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        ISSUE: ${{ github.event.issue.html_url }}
